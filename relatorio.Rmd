---
title: "Relatorio"
author: "Fabio Firanzi, Heitor Dias, Julia Fideles, Matheus Soares, Tiago Braga"
date: "2025-11-11"
#always_allow_html: true
output:
  pdf_document:
    latex_engine: pdflatex
    keep_tex: true
    includes:
      in_header: header.tex
classoption: twocolumn
header-includes: 
 \usepackage[T1]{fontenc} 
 \usepackage[utf8]{inputenc} 
 \usepackage[portuguese]{babel}
 \usepackage{booktabs} 
 \usepackage{float} 
 \usepackage{graphicx}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, message=FALSE, warning=FALSE}
#Carrega as bibliotecas necessárias
library(readxl)
library(dplyr)
library(ggplot2)
library(kableExtra)
library(knitr)
library(tidyr)
```

```{r setup-e-carga, message=FALSE, warning=FALSE}
amostra_10p <- read.csv("amostra_10p.csv")

```

```{r tabela-presenca, results='asis'}
freq_abs_presenca <- table(amostra_10p$TP_PRESENCA_LC)
freq_rel_presenca <- prop.table(freq_abs_presenca)

# Mapeamento dos códigos
rotulos <- c(
  "0" = "Ausente",
  "1" = "Presente",
  "2" = "Eliminado"
)

tabela <- data.frame(
  `Presença na prova` = rotulos[names(freq_abs_presenca)],
  Percentual = paste0(round(100 * as.vector(freq_rel_presenca), 2), "%"),
  Frequência = as.vector(freq_abs_presenca),
  check.names = FALSE
)

# ---- REMOVER OS NÚMEROS À ESQUERDA ----
tab <- knitr::kable(
  tabela,
  format    = "latex",
  booktabs  = TRUE,
  longtable = FALSE,
  row.names = FALSE   # <--- ESSENCIAL: remove a coluna com 0,1,2
)

cat(tab)

```

```{r grafico-presenca, message=FALSE, warning=FALSE, out.width="\\linewidth", fig.asp=0.5}
library(dplyr)
library(ggplot2)

# 1. Monta tabela de frequências com rótulos
dados_presenca <- amostra_10p %>%
  mutate(
    Status = case_when(
      TP_PRESENCA_LC == 0 ~ "Ausente",
      TP_PRESENCA_LC == 1 ~ "Presente",
      TP_PRESENCA_LC == 2 ~ "Eliminado"
    )
  )

tabela_graf <- dados_presenca %>%
  count(Status, name = "Frequencia") %>%
  mutate(
    Percentual = Frequencia / sum(Frequencia) * 100,
    label_pct  = paste0(round(Percentual, 1), "%"),
    # Ordem das barras: Presente, Ausente, Eliminado
    Status = factor(Status, levels = c("Presente", "Ausente", "Eliminado"))
  )

# 2. Gráfico de barras
ggplot(tabela_graf, aes(x = Status, y = Frequencia, fill = Status)) +
  geom_col() +
  geom_text(aes(label = label_pct),
            vjust = -0.5, size = 4) +
  scale_y_continuous(
    labels = scales::label_number(big.mark = ".", decimal.mark = ",")
  ) +
  scale_fill_manual(values = c(
    "Presente"  = "#2E7D32",  # verde
    "Ausente"   = "#A52A2A",  # vermelho tijolo
    "Eliminado" = "#D4AF37"   # dourado
  )) +
  labs(
    x = "Status de Presença",
    y = "Número de Alunos",
    fill = NULL
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = 0.5)
  )
```

# Tabela e gráfico de presença
  
  A tabela "Frequência de presença na prova de LC" e o Gráfico "Presença na prova de LC" exibem a porcentagem de alunos presentes, ausentes e eliminados na prova de linguágens e códigos. Com base nessa tabela, pode-se identificar que a grande maioria, 73,1%, dos alunos estava presente na avaliação, 26,7% ausente e uma minoria de 0,1% foi eliminada antes, durante ou após a prova. Embora a maioria tenha completado a avaliação, o alto índice de ausência sugere a necessidade de estudos futuros para investigar os fatores que contribuem para essa abstenção.
```{r hist-linguagens, out.width="\\linewidth", fig.asp=0.8, message=FALSE, warning=FALSE}
# Média e desvio padrão
media_LC <- mean(amostra_10p$NU_NOTA_LC, na.rm = TRUE)
sd_LC    <- sd(amostra_10p$NU_NOTA_LC, na.rm = TRUE)

# --- MELHORIA: Criar texto para anotação ---
label_texto <- paste(
  paste("Média =", round(media_LC, 2)),
  paste("Desvio Padrão =", round(sd_LC, 2)),
  sep = "\n" # Quebra a linha entre os dois
)

ggplot(amostra_10p, aes(x = NU_NOTA_LC)) +
  
  # Histograma em frequência relativa (%)
  geom_histogram(
    # --- MELHORIA: Adicionado 'aes(fill = ...)' para criar legenda ---
    aes(y = after_stat(density * 100), fill = "Notas dos Alunos"), 
    binwidth = 100,
    boundary = 0,
    color = "white",
    alpha = 0.7,
    na.rm = TRUE # <--- CORREÇÃO: Adicionado para silenciar aviso de NA
  ) +
  
  # Curva normal ajustada, também em %
  stat_function(
    # --- MELHORIA: Adicionado 'aes(color = ...)' para criar legenda ---
    aes(color = "Curva Normal Teórica"),
    fun = function(x) dnorm(x, mean = media_LC, sd = sd_LC) * 100,
    linewidth = 1.2
  ) +
  
  # --- MELHORIA: Adiciona linha vertical para a média ---
  geom_vline(
    aes(xintercept = media_LC, linetype = "Média da Amostra"),
    color = "darkblue",
    linewidth = 1
  ) +
  
  # --- MELHORIA: Adiciona texto com os valores da Média e DP ---
  # Ajuste 'x' e 'y' para a melhor posição no seu gráfico
  annotate(
    "text",
    x = 950, # Posição no eixo X (perto da direita)
    y = 0.35, # Posição no eixo Y (perto do topo)
    label = label_texto,
    hjust = 1, # Alinha o texto à direita
    color = "black",
    size = 3.5
  ) +

  # --- MELHORIA: Escalas manuais para cores e legendas ---
  scale_fill_manual(values = c("Notas dos Alunos" = "steelblue")) +
  scale_color_manual(values = c("Curva Normal Teórica" = "red")) +
  scale_linetype_manual(values = c("Média da Amostra" = "dashed")) +
  
  # --- MELHORIA: Formata os eixos X e Y ---
  scale_x_continuous(breaks = seq(0, 1000, 100)) +
  # --- ALTERAÇÃO AQUI (Removida a formatação de '%') ---
  scale_y_continuous(labels = scales::label_number()) + # <-- MUDANÇA REALIZADA AQUI

  labs(
    # --- MELHORIA: Título, Subtítulo e correção dos rótulos ---
    title = "Histograma da Nota de Linguagens e Códigos (LC)",
    subtitle = "Comparação da distribuição das notas com a Curva Normal",
    x = "Nota de Linguagens e Códigos (LC)",
    y = "Frequência relativa",
    # Remove títulos das legendas
    fill = NULL, 
    color = NULL,
    linetype = NULL
  ) +
  theme_minimal() +
  theme(
    panel.grid.major.x = element_blank(),
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5),
    # --- MELHORIA: Posiciona a legenda ---
    legend.position = "bottom"
  )

```

# Histograma da nota de LC

  Para a criação desse histograma foi utilizado a nota dos alunos presentes e não eliminados na avaliação de Linguagens e códigos, com esse dado sendo analizado em sua frequência, média, desvio padrão e distribuição.

  O “Histograma da Nota de LC” ilustra a distribuição de frequência das notas de Linguagens e Códigos para todos os alunos presentes. Ele foi construído sobrepondo uma curva normal teórica (linha vermelha), calculada a partir da média e do desvio padrão da amostra, sobre o histograma das notas reais (barras azuis). 
  
  A maior concentração de notas é de 500-600 pontos, contendo aproximadamente 55% dos alunos, o desvio padrão das notas é de 69,87.

```{r}
dados_presentes_ambas <- amostra_10p %>%
filter(
TP_PRESENCA_LC == 1,
TP_PRESENCA_MT == 1,
!is.na(NU_NOTA_LC), !is.na(NU_NOTA_MT),
NU_NOTA_LC > 0, NU_NOTA_MT > 0
)

resumo_LC <- dados_presentes_ambas %>%
summarise(
Prova = "LC",
Media = mean(NU_NOTA_LC),
Mediana = median(NU_NOTA_LC),
Desv.Padrao = sd(NU_NOTA_LC),
Minimo = min(NU_NOTA_LC),
Maximo = max(NU_NOTA_LC)
)

resumo_MT <- dados_presentes_ambas %>%
summarise(
Prova = "MT",
Media = mean(NU_NOTA_MT),
Mediana = median(NU_NOTA_MT),
Desv.Padrao = sd(NU_NOTA_MT),
Minimo = min(NU_NOTA_MT),
Maximo = max(NU_NOTA_MT)
)

tabela_comp <- bind_rows(resumo_LC, resumo_MT) %>%
mutate(
Media = round(Media, 2),
Mediana = round(Mediana, 1),
Desv.Padrao = round(Desv.Padrao, 2),
Minimo = round(Minimo, 1),
Maximo = round(Maximo, 1)
)

n_alunos <- nrow(dados_presentes_ambas)

kable(
tabela_comp,
format = "latex",
booktabs = TRUE,
col.names = c("Prova", "Média", "Mediana", "Desv. Padrão", "Min", "Máx"),
caption = paste0(
"Tabela Comparativa: LC vs MT (para ",
format(n_alunos, big.mark = ".", decimal.mark = ","),
" alunos presentes em ambas e com nota > 0)"
)
) %>%
kable_styling(full_width = FALSE)
```

# Tabela e gráfico LC vs MT

  A tabela "Tabela comparativa: LC vs MT" ilustra as, médias, medianas, desvios-padrão, notas mínimas e notas máximas das provas de linguagens e matemática, considerando apenas os alunos que estiveram presentes em ambas delas.
  
  O gráfico "comparação das distribuições de notas:LC vs MT" exibe os gráficos de distribuição de notas de linguagens e matemática sobrepostos, oferecendo uma comparação visual direta e clara da distribuição de notas das duas matérias.
  
  Embora as médias de linguagens e matemática tenham sido muito próximas, 526,7 e 527,2 respectivamente, a distribuição de notas da prova de matemática é totalmente diferente da de linguagens (que se aproxima de uma normal perfeita) tendo suas notas muito mais distribuidas no gráfico, evidenciando um desvio padrão muito maior.

```{r Gráfico de Densidade LC vs MT, message=FALSE, warning=FALSE}
# --- CHUNK CORRIGIDO: Gráfico de Densidade LC vs MT ---
# 1. Filtra para alunos presentes em AMBAS e com notas válidas
dados_presentes_ambas <- amostra_10p %>%
  filter(
    TP_PRESENCA_LC == 1 & TP_PRESENCA_MT == 1,
    !is.na(NU_NOTA_LC) & !is.na(NU_NOTA_MT),
    NU_NOTA_LC > 0 & NU_NOTA_MT > 0  # <--- ALTERAÇÃO AQUI
  )

# 2. Prepara os dados (Tidy)
dados_tidy <- dados_presentes_ambas %>%
  select(NU_NOTA_LC, NU_NOTA_MT) %>%
  tidyr::pivot_longer(
    cols = c(NU_NOTA_LC, NU_NOTA_MT),
    names_to = "Prova_Nome",
    values_to = "Nota"
  ) %>%
  # --- CORREÇÃO AQUI: Removido acentos ---
  mutate(Prova = case_when(
    Prova_Nome == "NU_NOTA_LC" ~ "Linguagens e Codigos",
    Prova_Nome == "NU_NOTA_MT" ~ "Matematica"
  ))

# 3. Calcula as médias para as linhas verticais
medias <- dados_tidy %>%
  group_by(Prova) %>%
  summarise(Media_Nota = mean(Nota, na.rm = TRUE)) # 'na.rm' por segurança

# 4. Plotar o gráfico
ggplot(dados_tidy, aes(x = Nota, fill = Prova)) +
  # Gráfico de densidade com transparência
  geom_density(alpha = 0.6, color = "white") +
  
  # Adiciona linhas verticais para as médias
  geom_vline(
    data = medias,
    aes(xintercept = Media_Nota, color = Prova),
    linewidth = 1,
    linetype = "dashed",
    show.legend = FALSE
  ) +
  
  # --- CORREÇÃO AQUI: Removido acentos das legendas ---
  scale_fill_manual(values = c("Linguagens e Codigos" = "firebrick", "Matematica" = "steelblue")) +
  scale_color_manual(values = c("Linguagens e Codigos" = "firebrick", "Matematica" = "steelblue")) +
  
  # Ajusta o eixo X
  scale_x_continuous(breaks = seq(0, 1000, 100)) +
  
  labs(
    title = "Comparação das Distribuições de Notas: LC vs MT",
    subtitle = "Para alunos presentes em ambas as provas (com nota > 0). Linhas tracejadas indicam a média.",
    x = "Nota",
    # --- CORREÇÃO AQUI: Removido acentos ---
    y = "Densidade (Frequencia Relativa)",
    fill = "Prova" # Título da legenda
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5)
  )
```

O Gráfico de Densidade oferece uma comparação visual direta entre as distribuições das notas de Linguagens (vermelho) e Matemática (azul). Este gráfico foi gerado utilizando apenas os alunos que compareceram e obtiveram nota maior que zero em ambas as provas. Percebe-se que a curva de Matemática é mais achatada e espalhada (refletindo o maior desvio padrão), indicando que há uma variabilidade muito maior nas notas. Em contraste, as notas de Linguagens são mais "pontudas" e concentradas em torno de sua média.

```{r boxplot-nota-regiao, message=FALSE, warning=FALSE}
# --- Chunk Corrigido: Boxplot Notas LC por Região (com N de alunos) ---

# PASSO 1: Criar a variável Regiao e adicionar o N de alunos
dados_para_boxplot <- amostra_10p %>%
  mutate(
    Regiao = case_when(
      SG_UF_PROVA %in% c('AM', 'AC', 'RO', 'RR', 'AP', 'PA', 'TO') ~ "Norte",
      SG_UF_PROVA %in% c('MA', 'PI', 'CE', 'RN', 'PB', 'PE', 'AL', 'SE', 'BA') ~ "Nordeste",
      SG_UF_PROVA %in% c('SP', 'MG', 'RJ', 'ES') ~ "Sudeste",
      SG_UF_PROVA %in% c('GO', 'DF', 'MT', 'MS') ~ "Centro-Oeste",
      SG_UF_PROVA %in% c('PR', 'SC', 'RS') ~ "Sul"
    )
  ) %>%
  # Filtra apenas quem tem nota válida para o boxplot
  filter(!is.na(NU_NOTA_LC) & !is.na(Regiao)) %>%
  
  # --- ADIÇÃO AQUI: Calcula o N para cada região ---
  group_by(Regiao) %>%
  mutate(n_alunos = n()) %>%
  ungroup() %>%
  
  # --- ALTERAÇÃO AQUI: Cria o novo rótulo (Regiao + N), removendo o "N=" ---
  # Usamos 'format' para adicionar o separador de milhar (ponto)
  mutate(Regiao_com_N = paste0(Regiao, " (", format(n_alunos, big.mark = "."), ")"))

# PASSO 2: Criar o Gráfico Boxplot para NU_NOTA_LC
ggplot(dados_para_boxplot, aes(
          # --- ALTERAÇÃO AQUI: Usa a nova coluna 'Regiao_com_N' ---
          x = reorder(Regiao_com_N, NU_NOTA_LC, FUN = median, na.rm = TRUE), 
          y = NU_NOTA_LC,
          fill = Regiao)) + # 'fill' ainda usa 'Regiao' para a cor
  
  geom_boxplot(
    show.legend = FALSE, # Remove legenda redundante
    outlier.shape = 21, 
    outlier.size = 1.5,
    na.rm = TRUE
  ) +
  
  # "Deita" o gráfico para facilitar a leitura
  coord_flip() + 
  
  labs(
    title = "Boxplot das Notas de linguagens por Região",
    subtitle = "Ordenado pela Mediana",
    x = "Região com total de alunos", # Texto do eixo
    y = "Nota de Linguagens e Códigos"
  ) +
  theme_minimal() +
  theme(
    # --- CORREÇÃO AQUI: Trocado '.' por '_' ---
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5)
  )
```

O Boxplot complementa a tabela estatística anterior, visualizando a distribuição das notas de Linguagens e Códigos por região. Ele foi criado agrupando os alunos por região e ordenando o eixo Y pela mediana das notas, da maior para a menor. Este gráfico permite uma visualização clara não apenas da mediana (a linha central na caixa), mas também da dispersão do "meio" dos alunos (o tamanho da caixa, ou Intervalo Interquartil) e dos outliers (pontos). Observa-se que as regiões Sudeste e Sul apresentam as medianas mais elevadas, enquanto as regiões Nordeste e Norte mostram um desempenho mediano inferior e uma dispersão de notas (tamanho da caixa) ligeiramente maior, indicando maior variação no desempenho dos alunos dessas regiões.

```{r tabela-boxplot, message=FALSE, warning=FALSE}
  dados_regiao <- amostra_10p %>%
filter(
TP_PRESENCA_LC == 1,
!is.na(NU_NOTA_LC),
NU_NOTA_LC > 0
) %>%
mutate(
Regiao = case_when(
SG_UF_PROVA %in% c('AM', 'AC', 'RO', 'RR', 'AP', 'PA', 'TO') ~ "N",
SG_UF_PROVA %in% c('MA', 'PI', 'CE', 'RN', 'PB', 'PE', 'AL', 'SE', 'BA') ~ "NE",
SG_UF_PROVA %in% c('SP', 'MG', 'RJ', 'ES') ~ "S",
SG_UF_PROVA %in% c('GO', 'DF', 'MT', 'MS') ~ "CO",
SG_UF_PROVA %in% c('PR', 'SC', 'RS') ~ "S"
)
) %>%
filter(!is.na(Regiao))

tabela_regiao <- dados_regiao %>%
group_by(Regiao) %>%
summarise(
Media = mean(NU_NOTA_LC),
Mediana = median(NU_NOTA_LC),
Variancia = var(NU_NOTA_LC),
Desv.Padrao = sd(NU_NOTA_LC),
Minimo = min(NU_NOTA_LC),
Maximo = max(NU_NOTA_LC),
`N de alunos` = n(),
.groups = "drop"
) %>%
mutate(
Media = round(Media, 2),
Mediana = round(Mediana, 1),
Variancia = round(Variancia, 2),
Desv.Padrao = round(Desv.Padrao, 2),
Minimo = round(Minimo, 1),
Maximo = round(Maximo, 1)
) %>%
arrange(factor(Regiao,
levels = c("SE", "S", "CO", "NE", "N")))

kable(
tabela_regiao,
format = "latex",
booktabs = TRUE,
col.names = c("Região", "Média", "Mediana", "Var",
"D. Padrão", "Min", "Máx", "Nº de Alunos")
) %>%
kable_styling(full_width = FALSE)
```

# Tabela e boxplot de notas LC por região

  A tabela "Estatísticas das notas de LC por Região" exibe as médias, medianas, variências, desvios-padrão, notas mínimas, notas máximas e número aproximado de alunos de cada região do Brasil.
  
  O "Boxplot das notas de linguagens por Região", ilustra a performance dos alunos de cada uma das regiões do Brasil exibindo a distribuição das notas. As "caixas" representam os 50% centrais dos alunos, com os pontos sendo os "outliers", ou seja, os fora da média, tanto para baixo quanto para cima e a linha dentro da caixa representa a mediana. 
  Com base no boxplot, a região Sudoeste obteve o melhor resultado, com sua média de 542,74 sendo a mais alta seguida de perto pela região Sul e sua média de 540.36, o boxplot também deixa evidente a desigualdade do país, com as regiões Norte e nordeste ficando significativamente atras das demais.